<?xml version="1.0"?>
<!--
  Stonefish scenario definition for AUV simulation
  Defines underwater environment, AUV with push actuators and sensors
  
  Sensors: IMU, DVL, Pressure (depth), Odometry (ground truth)
  Actuators: Push (virtual force actuators)
-->

<scenario>
    <environment>
        <ned latitude="40.0" longitude="3.0"/>
        <ocean>
            <water density="1025.0" jerlov="0.2" temperature="15.0"/>
            <waves height="0.0"/>
            <particles enabled="true"/>
        </ocean>
        <atmosphere>
            <sun azimuth="45.0" elevation="60.0"/>
        </atmosphere>
    </environment>

    <materials>
        <material name="Aluminium" density="2710.0" restitution="0.7"/>
        <material name="Polyurethane" density="1100.0" restitution="0.5"/>
        <!-- AUV composite: simulates hull with syntactic foam for near-neutral buoyancy -->
        <!-- Slightly less than water (1025) for gentle positive buoyancy -->
        <material name="AUV_Composite" density="950.0" restitution="0.5"/>
        <friction_table>
            <friction material1="Aluminium" material2="Aluminium" static="0.7" dynamic="0.4"/>
            <friction material1="Polyurethane" material2="Polyurethane" static="0.6" dynamic="0.3"/>
            <friction material1="AUV_Composite" material2="AUV_Composite" static="0.5" dynamic="0.3"/>
        </friction_table>
    </materials>

    <looks>
        <look name="AUV_Hull" rgb="0.9 0.5 0.1" roughness="0.3" metalness="0.2"/>
        <look name="Thruster" rgb="0.2 0.2 0.2" roughness="0.5" metalness="0.8"/>
    </looks>

    <!-- AUV Robot Definition -->
    <robot name="auv" fixed="false" self_collisions="false">

        <!-- Main hull - cylindrical body -->
        <base_link name="base_link" type="cylinder" physics="submerged" buoyant="true">
            <dimensions radius="0.15" height="1.5"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 1.5708 0.0"/>
            <material name="AUV_Composite"/>
            <look name="AUV_Hull"/>
            <compound_transform xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
        </base_link>

        <!-- Bow cap - spherical nose -->
        <link name="bow" type="sphere" physics="submerged" buoyant="true">
            <dimensions radius="0.15"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <material name="AUV_Composite"/>
            <look name="AUV_Hull"/>
        </link>

        <joint name="bow_joint" type="fixed">
            <parent name="base_link"/>
            <child name="bow"/>
            <origin xyz="0.75 0.0 0.0" rpy="0.0 0.0 0.0"/>
        </joint>

        <!-- Stern cap - spherical tail -->
        <link name="stern" type="sphere" physics="submerged" buoyant="true">
            <dimensions radius="0.15"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <material name="AUV_Composite"/>
            <look name="AUV_Hull"/>
        </link>

        <joint name="stern_joint" type="fixed">
            <parent name="base_link"/>
            <child name="stern"/>
            <origin xyz="-0.75 0.0 0.0" rpy="0.0 0.0 0.0"/>
        </joint>

        <!-- ================================================================ -->
        <!-- SENSORS -->
        <!-- ================================================================ -->

        <!-- IMU - Inertial Measurement Unit (orientation, angular velocity, acceleration) -->
        <sensor name="imu" rate="100.0" type="imu">
            <range angular_velocity="10.0 10.0 10.0" linear_acceleration="100.0"/>
            <noise angle="0.01 0.01 0.05" angular_velocity="0.01" yaw_drift="0.0001" linear_acceleration="0.05"/>
            <history samples="1"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <link name="base_link"/>
            <ros_publisher topic="/auv/imu"/>
        </sensor>

        <!-- DVL - Doppler Velocity Log (velocity relative to seabed) -->
        <sensor name="dvl" rate="10.0" type="dvl">
            <specs beam_angle="30.0" beam_positive_z="true"/>
            <range velocity="10.0 10.0 5.0" altitude_min="0.5" altitude_max="100.0"/>
            <noise velocity_percent="0.3" velocity="0.01" altitude="0.01"/>
            <history samples="1"/>
            <origin xyz="0.0 0.0 0.1" rpy="0.0 0.0 0.0"/>
            <link name="base_link"/>
            <ros_publisher topic="/auv/dvl"/>
        </sensor>

        <!-- Pressure sensor (for depth measurement) -->
        <sensor name="pressure" rate="10.0" type="pressure">
            <range pressure="1000000.0"/>
            <noise pressure="100.0"/>
            <history samples="1"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <link name="base_link"/>
            <ros_publisher topic="/auv/pressure"/>
        </sensor>

        <!-- Odometry (ground truth for debugging/comparison) -->
        <sensor name="odometry" rate="50.0" type="odometry">
            <noise position="0.0" velocity="0.0" angle="0.0" angular_velocity="0.0"/>
            <history samples="1"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <link name="base_link"/>
            <ros_publisher topic="/auv/odometry"/>
        </sensor>

        <!-- ================================================================ -->
        <!-- ACTUATORS (Push type - virtual force actuators) -->
        <!-- ================================================================ -->
        
        <!-- Surge force (main propulsion) - applies force along X-axis -->
        <actuator name="thruster_surge" type="push">
            <specs lower_limit="-100.0" upper_limit="100.0" inverted="false"/>
            <origin xyz="-0.75 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <link name="base_link"/>
            <ros_subscriber topic="/auv/thruster/surge"/>
        </actuator>

        <!-- Sway force (lateral movement) - applies force along Y-axis -->
        <actuator name="thruster_sway" type="push">
            <specs lower_limit="-50.0" upper_limit="50.0" inverted="false"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 1.5708"/>
            <link name="base_link"/>
            <ros_subscriber topic="/auv/thruster/sway"/>
        </actuator>

        <!-- Heave force (vertical movement) - applies force along Z-axis -->
        <actuator name="thruster_heave" type="push">
            <specs lower_limit="-50.0" upper_limit="50.0" inverted="false"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 -1.5708 0.0"/>
            <link name="base_link"/>
            <ros_subscriber topic="/auv/thruster/heave"/>
        </actuator>

        <!-- Yaw force (bow) - for rotation control -->
        <actuator name="thruster_yaw_bow" type="push">
            <specs lower_limit="-30.0" upper_limit="30.0" inverted="false"/>
            <origin xyz="0.5 0.0 0.0" rpy="0.0 0.0 1.5708"/>
            <link name="base_link"/>
            <ros_subscriber topic="/auv/thruster/yaw_bow"/>
        </actuator>

        <!-- Yaw force (stern) - for rotation control -->
        <actuator name="thruster_yaw_stern" type="push">
            <specs lower_limit="-30.0" upper_limit="30.0" inverted="true"/>
            <origin xyz="-0.5 0.0 0.0" rpy="0.0 0.0 1.5708"/>
            <link name="base_link"/>
            <ros_subscriber topic="/auv/thruster/yaw_stern"/>
        </actuator>

        <!-- World transform - start underwater at 5m depth -->
        <world_transform xyz="0.0 0.0 5.0" rpy="0.0 0.0 0.0"/>

    </robot>

    <!-- Seabed plane -->
    <static name="seabed" type="plane">
        <material name="Aluminium"/>
        <look name="AUV_Hull"/>
        <world_transform xyz="0.0 0.0 20.0" rpy="0.0 0.0 0.0"/>
    </static>

</scenario>
