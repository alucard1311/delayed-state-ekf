<?xml version="1.0"?>
<!--
  Stonefish scenario definition for AUV simulation
  Defines underwater environment and basic AUV with 4 thrusters
-->

<scenario>
    <environment>
        <ned latitude="40.0" longitude="3.0"/>
        <ocean>
            <water density="1025.0" jerlov="0.2" temperature="15.0"/>
            <waves height="0.0"/>
            <particles enabled="true"/>
            <!-- No current initially - can be added for testing -->
        </ocean>
        <atmosphere>
            <sun azimuth="45.0" elevation="60.0"/>
        </atmosphere>
    </environment>

    <materials>
        <material name="Aluminium" density="2710.0" restitution="0.7"/>
        <material name="Polyurethane" density="1100.0" restitution="0.5"/>
        <friction_table>
            <friction material1="Aluminium" material2="Aluminium" static="0.7" dynamic="0.4"/>
            <friction material1="Polyurethane" material2="Polyurethane" static="0.6" dynamic="0.3"/>
        </friction_table>
    </materials>

    <looks>
        <look name="AUV_Hull" rgb="0.9 0.5 0.1" roughness="0.3" metalness="0.2"/>
        <look name="Thruster" rgb="0.2 0.2 0.2" roughness="0.5" metalness="0.8"/>
    </looks>

    <!-- AUV Robot Definition -->
    <robot name="auv" fixed="false" self_collisions="false">

        <!-- Main hull - cylindrical body -->
        <base_link name="base_link" type="cylinder" physics="submerged" buoyant="true">
            <dimensions radius="0.15" height="1.5"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 1.5708 0.0"/>
            <material name="Aluminium"/>
            <look name="AUV_Hull"/>
            <compound_transform xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
        </base_link>

        <!-- Bow cap - spherical nose -->
        <link name="bow" type="sphere" physics="submerged" buoyant="true">
            <dimensions radius="0.15"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <material name="Polyurethane"/>
            <look name="AUV_Hull"/>
        </link>

        <joint name="bow_joint" type="fixed">
            <parent name="base_link"/>
            <child name="bow"/>
            <origin xyz="0.75 0.0 0.0" rpy="0.0 0.0 0.0"/>
        </joint>

        <!-- Stern cap - spherical tail -->
        <link name="stern" type="sphere" physics="submerged" buoyant="true">
            <dimensions radius="0.15"/>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <material name="Polyurethane"/>
            <look name="AUV_Hull"/>
        </link>

        <joint name="stern_joint" type="fixed">
            <parent name="base_link"/>
            <child name="stern"/>
            <origin xyz="-0.75 0.0 0.0" rpy="0.0 0.0 0.0"/>
        </joint>

        <!-- Thrusters for 4-DOF control -->

        <!-- Surge thruster (main propulsion) - rear facing -->
        <actuator name="thruster_surge" type="thruster">
            <specs max_setpoint="100.0" inverted_setpoint="false" normalized_setpoint="true"/>
            <propeller diameter="0.1" right="true">
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
                <material name="Aluminium"/>
                <look name="Thruster"/>
            </propeller>
            <rotor_dynamics type="first_order">
                <time_constant value="0.1"/>
            </rotor_dynamics>
            <thrust_model type="quadratic">
                <thrust_coeff forward="0.5" reverse="0.3"/>
                <torque_coeff value="0.01"/>
            </thrust_model>
            <origin xyz="-0.9 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <link name="base_link"/>
        </actuator>

        <!-- Sway thruster (lateral movement) -->
        <actuator name="thruster_sway" type="thruster">
            <specs max_setpoint="50.0" inverted_setpoint="false" normalized_setpoint="true"/>
            <propeller diameter="0.08" right="true">
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
                <material name="Aluminium"/>
                <look name="Thruster"/>
            </propeller>
            <rotor_dynamics type="first_order">
                <time_constant value="0.1"/>
            </rotor_dynamics>
            <thrust_model type="quadratic">
                <thrust_coeff forward="0.3" reverse="0.2"/>
                <torque_coeff value="0.01"/>
            </thrust_model>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 1.5708"/>
            <link name="base_link"/>
        </actuator>

        <!-- Heave thruster (vertical movement) -->
        <actuator name="thruster_heave" type="thruster">
            <specs max_setpoint="50.0" inverted_setpoint="false" normalized_setpoint="true"/>
            <propeller diameter="0.08" right="true">
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
                <material name="Aluminium"/>
                <look name="Thruster"/>
            </propeller>
            <rotor_dynamics type="first_order">
                <time_constant value="0.1"/>
            </rotor_dynamics>
            <thrust_model type="quadratic">
                <thrust_coeff forward="0.3" reverse="0.2"/>
                <torque_coeff value="0.01"/>
            </thrust_model>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 1.5708 0.0"/>
            <link name="base_link"/>
        </actuator>

        <!-- Yaw thrusters (rotation) - bow and stern pair -->
        <actuator name="thruster_yaw_bow" type="thruster">
            <specs max_setpoint="30.0" inverted_setpoint="false" normalized_setpoint="true"/>
            <propeller diameter="0.06" right="true">
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
                <material name="Aluminium"/>
                <look name="Thruster"/>
            </propeller>
            <rotor_dynamics type="first_order">
                <time_constant value="0.1"/>
            </rotor_dynamics>
            <thrust_model type="quadratic">
                <thrust_coeff forward="0.2" reverse="0.15"/>
                <torque_coeff value="0.005"/>
            </thrust_model>
            <origin xyz="0.5 0.0 0.0" rpy="0.0 0.0 1.5708"/>
            <link name="base_link"/>
        </actuator>

        <actuator name="thruster_yaw_stern" type="thruster">
            <specs max_setpoint="30.0" inverted_setpoint="true" normalized_setpoint="true"/>
            <propeller diameter="0.06" right="false">
                <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
                <material name="Aluminium"/>
                <look name="Thruster"/>
            </propeller>
            <rotor_dynamics type="first_order">
                <time_constant value="0.1"/>
            </rotor_dynamics>
            <thrust_model type="quadratic">
                <thrust_coeff forward="0.2" reverse="0.15"/>
                <torque_coeff value="0.005"/>
            </thrust_model>
            <origin xyz="-0.5 0.0 0.0" rpy="0.0 0.0 1.5708"/>
            <link name="base_link"/>
        </actuator>

        <!-- Sensors (placeholders - to be wired to ROS2 topics in Phase 2) -->

        <!-- World transform - start underwater at 5m depth -->
        <world_transform xyz="0.0 0.0 5.0" rpy="0.0 0.0 0.0"/>

    </robot>

    <!-- Seabed plane -->
    <static name="seabed" type="plane">
        <material name="Aluminium"/>
        <look name="AUV_Hull"/>
        <world_transform xyz="0.0 0.0 20.0" rpy="0.0 0.0 0.0"/>
    </static>

</scenario>
