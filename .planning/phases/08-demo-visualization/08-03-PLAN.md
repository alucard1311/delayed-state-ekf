---
phase: 08-demo-visualization
plan: 03
type: execute
wave: 2
depends_on: ["08-01", "08-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Nominal scenario achieves <2m final error and <5m max error"
    - "DVL dropout scenario shows error growth then USBL recovery"
    - "High outlier scenario rejects outliers without position jumps"
  artifacts: []
  key_links: []
---

<objective>
Run all three demo scenarios and verify navigation performance meets requirements.

Purpose: Validate the complete USBL navigation system and generate publication-quality results.
Output: Verified scenarios, generated plots, documented performance metrics.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-demo-visualization/08-01-SUMMARY.md
@.planning/phases/08-demo-visualization/08-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run nominal scenario and collect metrics</name>
  <files></files>
  <action>
    1. Build the workspace: colcon build --packages-select usbl_navigation

    2. Source the workspace: source install/setup.bash

    3. Create output directory: mkdir -p /tmp/usbl_demo/nominal

    4. Run nominal scenario for 180 seconds (3 minutes - covers full lawnmower):
       ```
       timeout 180 ros2 launch usbl_navigation simulation.launch.py \
         scenario:=nominal \
         output_dir:=/tmp/usbl_demo/nominal
       ```

    5. Generate plots:
       ```
       python3 install/usbl_navigation/lib/usbl_navigation/plot_results.py \
         /tmp/usbl_demo/nominal/navigation_metrics.csv \
         --output-dir /tmp/usbl_demo/nominal
       ```

    6. Capture summary statistics from script output

    7. Verify requirements:
       - Final error (last row) < 2m
       - Max error < 5m
       - RMSE reasonable (< 2m)

    If metrics fail requirements, investigate and note in summary.
  </action>
  <verify>ls /tmp/usbl_demo/nominal/*.png shows 3 plot files</verify>
  <done>Nominal scenario metrics collected, plots generated</done>
</task>

<task type="auto">
  <name>Task 2: Run DVL dropout (canyon) scenario</name>
  <files></files>
  <action>
    1. Create output directory: mkdir -p /tmp/usbl_demo/canyon

    2. Run canyon dropout scenario for 180 seconds:
       ```
       timeout 180 ros2 launch usbl_navigation simulation.launch.py \
         scenario:=canyon_dropout \
         output_dir:=/tmp/usbl_demo/canyon
       ```

    3. Generate plots:
       ```
       python3 install/usbl_navigation/lib/usbl_navigation/plot_results.py \
         /tmp/usbl_demo/canyon/navigation_metrics.csv \
         --output-dir /tmp/usbl_demo/canyon
       ```

    4. Verify in sawtooth plot:
       - Error grows during DVL dropout period (t=120-150s)
       - Error recovers after DVL returns
       - USBL provides position fixes during dropout

    5. Document the error behavior during dropout period
  </action>
  <verify>ls /tmp/usbl_demo/canyon/*.png shows 3 plot files</verify>
  <done>Canyon scenario shows error growth and USBL-aided recovery</done>
</task>

<task type="auto">
  <name>Task 3: Run high outlier scenario</name>
  <files></files>
  <action>
    1. Create output directory: mkdir -p /tmp/usbl_demo/outlier

    2. Run high outlier scenario for 180 seconds:
       ```
       timeout 180 ros2 launch usbl_navigation simulation.launch.py \
         scenario:=high_outlier \
         output_dir:=/tmp/usbl_demo/outlier
       ```

    3. Generate plots:
       ```
       python3 install/usbl_navigation/lib/usbl_navigation/plot_results.py \
         /tmp/usbl_demo/outlier/navigation_metrics.csv \
         --output-dir /tmp/usbl_demo/outlier
       ```

    4. Verify in trajectory plot:
       - No sudden jumps in estimate position
       - Estimate tracks truth smoothly despite 20% outlier rate
       - Mahalanobis gating successfully rejects bad measurements

    5. Document outlier rejection behavior (check logs for "rejected" messages)
  </action>
  <verify>ls /tmp/usbl_demo/outlier/*.png shows 3 plot files</verify>
  <done>Outlier scenario shows smooth trajectory without position jumps</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete USBL navigation demo with three scenarios</what-built>
  <how-to-verify>
    1. Review nominal scenario plots in /tmp/usbl_demo/nominal/:
       - error_sawtooth.png: Sawtooth pattern visible (error drops on USBL fixes)
       - trajectory.png: Estimate (orange) tracks truth (blue) closely
       - covariance_bounds.png: Error stays within 3-sigma bounds

    2. Review canyon scenario plots in /tmp/usbl_demo/canyon/:
       - error_sawtooth.png: Clear error spike during t=120-150s
       - Visible recovery after DVL returns

    3. Review outlier scenario plots in /tmp/usbl_demo/outlier/:
       - trajectory.png: No sudden jumps or discontinuities
       - Smooth tracking despite high outlier rate

    4. Verify performance metrics from Task 1:
       - Final error < 2m (SCEN-01)
       - Max error < 5m (SCEN-01)

    5. Optional: Run with RViz to see real-time visualization:
       ```
       ros2 launch usbl_navigation simulation.launch.py scenario:=nominal rviz:=true
       ```
  </how-to-verify>
  <resume-signal>Type "approved" if all scenarios meet requirements, or describe issues to investigate</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Nominal scenario: final error < 2m, max error < 5m
- [ ] Canyon scenario: error growth visible during dropout, recovery afterward
- [ ] Outlier scenario: no position jumps despite 20% outlier rate
- [ ] All 9 plot files generated (3 scenarios Ã— 3 plots)
- [ ] Human verification approved
</verification>

<success_criteria>

- All three scenarios run successfully
- Nominal performance meets SCEN-01 requirements
- DVL dropout demonstrates SCEN-02 behavior
- Outlier rejection demonstrates SCEN-03 behavior
- Human verified plot quality suitable for presentation
</success_criteria>

<output>
After completion, create `.planning/phases/08-demo-visualization/08-03-SUMMARY.md`
</output>
