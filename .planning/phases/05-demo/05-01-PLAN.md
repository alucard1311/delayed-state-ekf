---
phase: 05-demo
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/auv_planner/config/mission.yaml]
autonomous: false

must_haves:
  truths:
    - "AUV dives from surface to 3m depth"
    - "AUV navigates to at least 2 waypoints at depth"
    - "AUV surfaces after waypoint sequence completes"
    - "Entire mission runs without manual intervention"
    - "Mission state transitions visible: IDLE → DIVING → NAVIGATING → SURFACING → COMPLETE"
  artifacts:
    - path: "src/auv_planner/config/mission.yaml"
      provides: "Demo mission waypoints"
      contains: "waypoints:"
    - path: "src/auv_sim/launch/full_simulation.launch.py"
      provides: "Full stack launcher"
      contains: "planner_node"
  key_links:
    - from: "planner_node"
      to: "/auv/cmd/depth"
      via: "depth command publish"
    - from: "planner_node"
      to: "/auv/ekf/pose"
      via: "state feedback subscription"
    - from: "control_node"
      to: "/auv/thruster/*"
      via: "thruster commands"
---

<objective>
Verify and document the complete autonomous mission demo.

Purpose: Confirm all DEMO requirements are satisfied with a clean mission run, ready for code walkthrough.
Output: Verified autonomous mission with documented test run.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-planning/04-03-SUMMARY.md

**Phase 5 Requirements:**
- DEMO-01: AUV dives from surface to commanded depth
- DEMO-02: AUV navigates to at least one waypoint underwater
- DEMO-03: AUV surfaces after completing waypoint sequence
- DEMO-04: Complete mission runs autonomously without operator intervention

**What's already built (Phase 4):**
- State machine: IDLE → DIVING → NAVIGATING → SURFACING → COMPLETE
- Planner node publishes /auv/cmd/{depth,heading,velocity}
- Planner subscribes to /auv/ekf/pose
- Full simulation launch includes all nodes
- User verified "working now" in Phase 4

**Current mission.yaml waypoints:**
- WP1: (5, 0, 3) - 5m east at 3m depth
- WP2: (5, 5, 3) - then 5m north
- WP3: (0, 5, 3) - return west
- cruise_velocity: 0.3 m/s

**Known constraints:**
- Velocity limited to ~0.3 m/s (thruster/drag balance)
- Depth controller works well
- Heading controller works well
</context>

<tasks>

<task type="auto">
  <name>Task 1: Review mission configuration for demo</name>
  <files>src/auv_planner/config/mission.yaml</files>
  <action>
Read the current mission.yaml and verify it's suitable for a demo:
- Waypoints should form a clear geometric pattern (easy to explain)
- Distances should be short enough for quick demo (~5-10m between points)
- Depth should be visible in Stonefish (3m is good)
- At least 2-3 waypoints to show navigation

Current config is already good. Only modify if waypoints are too far apart for demo timing.
  </action>
  <verify>cat src/auv_planner/config/mission.yaml</verify>
  <done>Mission configuration suitable for demo</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete autonomous mission stack from Phases 1-4</what-built>
  <how-to-verify>
    **Full Demo Verification:**

    1. Build and source:
       ```
       colcon build
       source install/setup.bash
       ```

    2. Launch full simulation:
       ```
       ros2 launch auv_sim full_simulation.launch.py
       ```

    3. In a second terminal, monitor mission state:
       ```
       source install/setup.bash
       ros2 topic echo /auv/mission/state
       ```

    4. Watch the complete mission sequence:

       **DIVING phase:**
       - AUV descends from surface
       - Watch depth increase toward 3m
       - State shows "DIVING"

       **NAVIGATING phase:**
       - AUV moves horizontally toward waypoints
       - State shows "NAVIGATING (WP1/3)" then "NAVIGATING (WP2/3)" etc.
       - AUV should reach at least 2 waypoints

       **SURFACING phase:**
       - After last waypoint, state changes to "SURFACING"
       - AUV ascends toward surface
       - Depth decreases toward 0

       **COMPLETE:**
       - State shows "COMPLETE"
       - Mission finished successfully

    5. Verify DEMO requirements:
       - [x] DEMO-01: Dives to depth (3m)
       - [x] DEMO-02: Navigates to waypoints
       - [x] DEMO-03: Surfaces after waypoints
       - [x] DEMO-04: Runs autonomously (no manual commands)

    **Expected timing:** ~2-3 minutes for full mission (slow velocity)
  </how-to-verify>
  <resume-signal>Type "approved" if mission completes successfully, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Mission configuration reviewed
- [ ] Full mission executed: IDLE → DIVING → NAVIGATING → SURFACING → COMPLETE
- [ ] At least 2 waypoints reached during NAVIGATING
- [ ] No manual intervention required
- [ ] Human approved mission behavior
</verification>

<success_criteria>
- All tasks completed
- DEMO-01 through DEMO-04 requirements verified
- Human approved autonomous mission
- System ready for code walkthrough demo
</success_criteria>

<output>
After completion, create `.planning/phases/05-demo/05-01-SUMMARY.md`
</output>
